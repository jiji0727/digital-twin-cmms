# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ğŸ“¦ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: https://page.gensparksite.com/project_backups/digital-twin-cmms-full.tar.gz

**ã‚µã‚¤ã‚º**: ç´„73MBï¼ˆBig Mirror 3Dãƒ¢ãƒ‡ãƒ«å«ã‚€ï¼‰

## ğŸ› ï¸ å¿…è¦ãªç’°å¢ƒ

- **Node.js**: v18ä»¥ä¸Š
- **npm**: v9ä»¥ä¸Š
- **OS**: Windows / macOS / Linux

## ğŸ“¥ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

### 1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼†è§£å‡

```bash
# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
wget https://page.gensparksite.com/project_backups/digital-twin-cmms-full.tar.gz

# è§£å‡
tar -xzf digital-twin-cmms-full.tar.gz

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd home/user/webapp
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
npm run db:migrate:local

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
npm run db:seed
```

### 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# ãƒ“ãƒ«ãƒ‰
npm run build

# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev:sandbox
```

ã¾ãŸã¯ã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼š

```bash
chmod +x deploy.sh
./deploy.sh
```

### 5. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹

```
http://localhost:3000
```

## ğŸ® ä½¿ã„æ–¹

### åŸºæœ¬æ“ä½œ

1. **3Dç©ºé–“ã®æ“ä½œ**:
   - å·¦ãƒ‰ãƒ©ãƒƒã‚°: ã‚«ãƒ¡ãƒ©å›è»¢
   - å³ãƒ‰ãƒ©ãƒƒã‚°: ã‚«ãƒ¡ãƒ©ç§»å‹•
   - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«: ã‚ºãƒ¼ãƒ 

2. **ç·¨é›†ãƒ¢ãƒ¼ãƒ‰**:
   - ã€Œç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - è¨­å‚™ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
   - ä½ç½®ãŒè‡ªå‹•ä¿å­˜ã•ã‚Œã‚‹

3. **æ–°è¦è¨­å‚™è¿½åŠ **:
   - ã€Œè¨­å‚™è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - è¨­å‚™æƒ…å ±ã‚’å…¥åŠ›
   - 3Dç©ºé–“ã§ä½ç½®ã‚’æŒ‡å®š

## ğŸ“ é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

```
webapp/
â”œâ”€â”€ src/index.tsx              # Hono REST APIï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰
â”œâ”€â”€ public/static/js/viewer.js # 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ï¼†CMMSæ©Ÿèƒ½ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
â”œâ”€â”€ public/models/BigMirror/   # 3Dãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆ31MBï¼‰
â”œâ”€â”€ migrations/                 # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ seed.sql                    # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ deploy.sh                   # è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ wrangler.jsonc             # Cloudflareè¨­å®š
```

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### è¨­å‚™ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´

`seed.sql` ã‚’ç·¨é›†ã—ã¦ã‹ã‚‰ï¼š

```bash
npm run db:reset
```

### 3Dãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´

`public/models/BigMirror/` å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãæ›ãˆã‚‹ã€‚
LCCå½¢å¼ï¼ˆ.lccï¼‰ã®ãƒ¢ãƒ‡ãƒ«ãŒå¿…è¦ã§ã™ã€‚

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¿½åŠ 

`src/index.tsx` ã‚’ç·¨é›†ï¼š

```typescript
app.get('/api/your-endpoint', async (c) => {
  // Your logic here
  return c.json({ data: 'value' })
})
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆ3000ãŒä½¿ç”¨ä¸­

```bash
# Windowsã®å ´åˆ
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# macOS/Linuxã®å ´åˆ
lsof -ti:3000 | xargs kill -9
```

### ãƒ¢ãƒ‡ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªï¼ˆF12ï¼‰
2. `public/models/BigMirror/` ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
3. ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ï¼š

```bash
./deploy.sh
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

```bash
# DBã‚’ãƒªã‚»ãƒƒãƒˆ
npm run db:reset

# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
./deploy.sh
```

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

```bash
# node_modulesã‚’å‰Šé™¤ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
npm run build
```

## ğŸ“Š åˆ©ç”¨å¯èƒ½ãªnpmã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆViteï¼‰
npm run dev

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆWranglerã€æœ¬ç•ªç›¸å½“ï¼‰
npm run dev:sandbox

# D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»˜ãé–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev:d1

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
npm run preview

# ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆCloudflare Pagesï¼‰
npm run deploy:prod

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
npm run db:migrate:local      # ãƒ­ãƒ¼ã‚«ãƒ«DBã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run db:migrate:prod       # æœ¬ç•ªDBã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run db:seed               # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
npm run db:reset              # DBãƒªã‚»ãƒƒãƒˆï¼†å†æ§‹ç¯‰
npm run db:console:local      # ãƒ­ãƒ¼ã‚«ãƒ«DBæ“ä½œ
npm run db:console:prod       # æœ¬ç•ªDBæ“ä½œ

# ãƒãƒ¼ãƒˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
npm run clean-port

# ãƒ†ã‚¹ãƒˆ
npm test
```

## ğŸŒ æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### Cloudflare Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. **Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
   - https://dash.cloudflare.com/sign-up

2. **D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ**

```bash
npx wrangler d1 create digital-twin-cmms-production
```

3. **wrangler.jsoncæ›´æ–°**

å‡ºåŠ›ã•ã‚ŒãŸdatabase_idã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `wrangler.jsonc` ã«è²¼ã‚Šä»˜ã‘

4. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ**

```bash
npm run db:migrate:prod
```

5. **ãƒ‡ãƒ—ãƒ­ã‚¤**

```bash
npm run deploy:prod
```

## ğŸ“ ç’°å¢ƒå¤‰æ•°

ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ã« `.dev.vars` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆä»»æ„ï¼‰:

```env
# .dev.vars
NODE_ENV=development
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

- `.dev.vars` ã¨ `.env` ã¯Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„
- æœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
- APIã‚­ãƒ¼ã¯Cloudflare Secretsã«ä¿å­˜

## ğŸ“š è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹

- **Hono ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://hono.dev/
- **Cloudflare Workers**: https://developers.cloudflare.com/workers/
- **Cloudflare D1**: https://developers.cloudflare.com/d1/
- **Three.js**: https://threejs.org/
- **Vite**: https://vitejs.dev/

## ğŸ’¡ é–‹ç™ºã®ãƒ’ãƒ³ãƒˆ

### Hot Reload

`npm run dev:sandbox` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•çš„ã«ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚

### ãƒ‡ãƒãƒƒã‚°

ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ä»¥ä¸‹ãŒåˆ©ç”¨å¯èƒ½ï¼š

```javascript
// ãƒ“ãƒ¥ãƒ¼ã‚¢ã®çŠ¶æ…‹ç¢ºèª
console.log(window.viewerState)

// LCC SDK
console.log(window.LCCRender)

// LCCã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
console.log(window.lccObj)

// Three.js
console.log(window.THREE)
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

1. **IndexDBã‚­ãƒ£ãƒƒã‚·ãƒ¥**: 2å›ç›®ä»¥é™ã®èª­ã¿è¾¼ã¿ãŒé«˜é€ŸåŒ–
2. **ç‚¹ç¾¤å¯†åº¦èª¿æ•´**: UIã®ã€Œç‚¹ç¾¤å¯†åº¦ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§èª¿æ•´
3. **ãƒãƒ¼ã‚«ãƒ¼æ•°åˆ¶é™**: å¤§é‡ã®è¨­å‚™ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤ºã‚’åˆ¶é™

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèª
2. ãƒ‡ãƒ¼ã‚¿ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
3. æ©Ÿèƒ½ã‚’è¿½åŠ /å¤‰æ›´
4. Cloudflare Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤

## â“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

1. README.mdã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
2. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
3. `/tmp/wrangler.log` ã§ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª

---

**æœ€çµ‚æ›´æ–°**: 2024-11-08
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.2.0
